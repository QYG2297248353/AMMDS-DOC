---
sidebar_position: 2
sidebar_label: "スクレイピング設定"
---

# スクレイピング設定

スクレイピング設定は、タスク実行前に、システムがネットワークから動画のメタデータを取得する方法、ファイルディレクトリ構造を整理する方法、およびその他のスクレイピング関連のパラメータを設定するためのもので、スクレイピングプロセスが効率的かつ正確に動画リソースを取得・整理できるようにします。

<!-- truncate -->

## スクレイピング設定へのアクセス

スクレイピング規則設定ページには、以下のパスからアクセスできます：

**タスク管理 >> スクレイピング規則設定**

:::info 操作のヒント
設定を更新した後、必ず **保存** ボタンをクリックしてください。そうしないと設定は反映されません。
:::

## 設定インターフェース

![スクレイピング規則設定](/img/usage/module/scrape-config-01.png)

![スクレイピング規則設定](/img/usage/module/scrape-config-02.png)

![スクレイピング規則設定](/img/usage/module/scrape-config-03.png)

## 基本設定

### 文字フィルタリング

**機能説明**：スクレイピング時にファイル名をフィルタリングし、不要な文字を事前にフィルタリングして番号の識別率を向上させます。

**効果**：ファイル名から妨害文字を除去することで、システムが動画番号をより正確に識別し、より正確なメタデータを取得できるようにします。

### 画像ダウンロードの失敗を許可

**機能説明**：画像のダウンロードに失敗した場合に、スクレイピングタスクを続行するかどうかを設定します。

**効果**：このオプションを有効にすると、画像のダウンロードに失敗してもスクレイピング結果の取得に影響がなく、スクレイピングの成功率が向上します。

### ディレクトリ整理形式

**機能説明**：スクレイピング完了後のディレクトリの組織構造を設定します。

**設定方法**：システムが提供する変数を組み合わせて、ディレクトリの形式をカスタマイズします。

**例**：`${actor}/${number}` は、俳優名を第一階層のディレクトリ、動画番号を第二階層のディレクトリとする構造を作成します。

### ファイル名整理形式

**機能説明**：スクレイピング完了後の動画ファイルの命名形式を設定します。

**設定方法**：システムが提供する変数を組み合わせて、ファイル名の形式をカスタマイズします。

**例**：`${title_safe}.${ext}` は、安全な動画タイトルをファイル名として使用し、元のファイル拡張子を保持します。

### 自動スクレイピング

**機能説明**：スキャンタスク完了後に自動的にスクレイピングタスクをトリガーするかどうかを設定します。

**デフォルトの動作**：デフォルトでは、スキャンされたファイルを手動で選択してスクレイピングタスクを実行する必要があります。

**有効化の効果**：有効にすると、システムは設定されたルールに従って、スクレイピング可能な動画ファイルを自動的に検出してスクレイピングを実行します。

### 自動スクレイピング間隔

**機能説明**：自動スクレイピングタスクの実行間隔を設定します。

**単位**：分

**デフォルト値**：3分（自動スクレイピングを有効にした場合）

### 高清カバーのダウンロード

**機能説明**：動画の高清カバーをダウンロードするかどうかを設定します。

**ダウンロード元**：有効にすると、システムは Fanza DMM から高清カバーを取得しようとします。なければ、他のソースから取得しようとします。

### 外部字幕検索

**機能説明**：動画の外部字幕（ソフト字幕）を検索してダウンロードするかどうかを設定します。

**保存場所**：ダウンロードされた字幕ファイルは、最終的なスクレイピングディレクトリに保存されます。

### 番号の混在

**機能説明**：スクレイピング後に生成される nfo ファイルにおいて、タイトルなどのフィールドに番号のプレフィックスを追加するかどうかを設定します。

### 自動タグ

**機能説明**：スクレイピング後に生成される nfo ファイルの tag タグに追加情報を追加するかどうかを設定します。

**例**：解像度、番号、中国語字幕、モザイク解除などのタグを追加します。

### 自動カテゴリタグ

**機能説明**：スクレイピング後に生成される nfo ファイルの genre タグに追加情報を追加するかどうかを設定します。

**例**：解像度、番号、中国語字幕、モザイク解除などのタグを追加します。

### ローカルデータ優先

**機能説明**：スクレイピング時にローカルに既存のデータを優先して使用するかどうかを設定します。

**効果**：ローカルに既存のデータがスクレイピングルールに合致する場合、ネットワークからデータをダウンロードしたり更新したりするのではなく、ローカルデータを直接使用するため、スクレイピングの効率が向上します。

### スクレイパー

**機能説明**：システムが使用するスクレイパーを選択します。

**利用可能なスクレイパー**：
- **ローカル**：ユーザーが手動で作成した動画情報を使用します
- **Metatube** (プラグイン)
- **ThePornDB** (プラグイン)
- **Stash** (プラグイン)
- **Fanza DMM** (プラグイン)

### スクリーンショットのスクレイピング

**機能説明**：動画のスクリーンショットをダウンロードするかどうかを設定します。

**保存場所**：ダウンロードされたスクリーンショットファイルは、指定されたディレクトリに保存されます。

### スクリーンショットディレクトリ

**機能説明**：スクリーンショットファイルの保存ディレクトリを設定します。

**デフォルト値**：動画ファイルと同じディレクトリの `extrafanart` ディレクトリに保存されます。

### マルチスレッド実行

**機能説明**：スクレイピングタスクをマルチスレッドで実行するかどうかを設定します。

**メリットとデメリット**：
- **メリット**：有効にするとスクレイピングの効率が向上します
- **デメリット**：システムリソースの消費が増加します

**推奨**：システムリソースの状況に応じて、マルチスレッド実行を適切に設定してください。例えば、システムに 4 つの CPU コアがある場合、4 つのスレッドに設定することを推奨します。

### 最大スレッド数

**機能説明**：スクレイピング時の最大スレッド数を設定します。

**デフォルト値**：5 スレッド

**推奨**：システムリソースの状況に応じて、最大スレッド数を適切に設定してください。

## ディレクトリとファイル名の整理

設定項目には、**ディレクトリ整理形式** と **ファイル名整理形式** の 2 つのオプションがあります。システムが提供する変数を組み合わせることで、ディレクトリとファイル名の形式をカスタマイズすることができます。

### セーフ変数

**効果**：変数名の後に `_safe` サフィックスを追加することで、ファイル名に特殊文字が含まれることによる問題を回避します。

**例**：`${actor_safe}` は、俳優名に特殊文字が出現した場合、安全な文字に置き換えられます。

**効果**：動画タイトルの特殊文字によるディレクトリ階層の中断を回避し、ディレクトリ構造の完全性を確保します。

### 整理例

完全な動画ファイルは、`${actor}/${number}/${title_safe}.${ext}` に整理されます。

**例**：
- 俳優名："John Doe"
- 動画番号："ABC-123"
- 動画タイトル："Sample Title"
- ファイル拡張子："mkv"

**最終的な整理後のパス**：`John Doe/ABC-123/Sample Title.mkv`

### ディレクトリ整理変数

**デフォルト設定**：`${actor}/${number}`

**注意**：`/` はディレクトリ区切り文字として認識され、異なるディレクトリ階層を作成することができます。

| 変数名 | セーフ変数名 | 説明 | 例 |
|--------|------------|------|------|
| `${actor}` | `${actor_safe}` | 俳優名 | "John Smith" |
| `${number}` | `${number_safe}` | 動画番号 | "ABC-123" |
| `${title}` | `${title_safe}` | 動画タイトル | "Sample Title" |
| `${date}` | `${date_safe}` | 発売日 | "2024/01/01" |
| `${year}` | `${year_safe}` | 発売年 | "2024" |
| `${month}` | `${month_safe}` | 発売月 | "01" |
| `${day}` | `${day_safe}` | 発売日 | "01" |
| `${mosaic}` | `${mosaic_safe}` | モザイクタイプ | "無修正/修正" |
| `${resolution}` | `${resolution_safe}` | 動画解像度 | "1080p" |
| `${director}` | `${director_safe}` | 監督名 | "Director Name" |
| `${studio}` | `${studio_safe}` | 制作会社名 | "Studio Name" |

**デフォルト値**：すべての変数にはデフォルト値があり、指定されていない場合はデフォルト値が使用されます。

### ファイル名整理変数

**デフォルト設定**：`${number}`

| 変数名 | セーフ変数名 | 説明 | 例 |
|--------|------------|------|------|
| `${actor}` | `${actor_safe}` | 俳優名 | "John Smith" |
| `${number}` | `${number_safe}` | 動画番号 | "ABC-123" |
| `${title}` | `${title_safe}` | 動画タイトル | "Sample Title" |
| `${date}` | `${date_safe}` | 発売日 | "2024/01/01" |
| `${year}` | `${year_safe}` | 発売年 | "2024" |
| `${month}` | `${month_safe}` | 発売月 | "01" |
| `${day}` | `${day_safe}` | 発売日 | "01" |
| `${mosaic}` | `${mosaic_safe}` | モザイクタイプ | "無修正/修正" |
| `${resolution}` | `${resolution_safe}` | 動画解像度 | "1080p" |
| `${director}` | `${director_safe}` | 監督名 | "Director Name" |
| `${studio}` | `${studio_safe}` | 制作会社名 | "Studio Name" |

## 設定例

以下は、典型的なスクレイピング設定の例です：

| 設定項目 | 設定値 |
|--------|--------|
| 文字フィルタリング | 有効 |
| 画像ダウンロードの失敗を許可 | 有効 |
| ディレクトリ整理形式 | `${actor}/${number}` |
| ファイル名整理形式 | `${title_safe}.${ext}` |
| 自動スクレイピング | 有効 |
| 自動スクレイピング間隔 | 5分 |
| 高清カバーのダウンロード | 有効 |
| 外部字幕検索 | 有効 |
| 番号の混在 | 有効 |
| 自動タグ | 有効 |
| 自動カテゴリタグ | 有効 |
| ローカルデータ優先 | 有効 |
| スクレイパー | Metatube, Fanza DMM |
| スクリーンショットのスクレイピング | 有効 |
| スクリーンショットディレクトリ | extrafanart |
| マルチスレッド実行 | 有効 |
| 最大スレッド数 | 4 |

## よくある質問

### Q: なぜスクレイピングに失敗するのですか？

**A**：考えられる理由は以下の通りです：
- 番号識別エラー
- ネットワーク接続の問題
- スクレイパーが一致するメタデータを見つけられない
- 設定エラー

### Q: スクレイピングの成功率を向上させるにはどうすればよいですか？

**A**：以下の方法を試すことができます：
- ファイル名の番号が明確に識別できるようにする
- 文字フィルタリング機能を有効にする
- 複数のスクレイパーを設定する
- ネットワーク接続が正常であることを確認する

### Q: 自動スクレイピングと手動スクレイピングの違いは何ですか？

**A**：
- **自動スクレイピング**：スキャン完了後に自動的に実行され、手動操作は不要で、一括処理に適しています
- **手動スクレイピング**：ファイルを手動で選択してスクレイピングを実行する必要があり、スクレイピング結果に高い要求がある場面に適しています

### Q: なぜダウンロードした字幕ファイルが動画ファイルと一致しないのですか？

**A**：考えられる理由は以下の通りです：
- 字幕検索時の番号識別が正確でない
- ネットワーク接続の問題により字幕のダウンロードに失敗した
- 字幕ファイルの命名が動画ファイルと一致しない

### Q: ディレクトリ構造をカスタマイズするにはどうすればよいですか？

**A**：システムが提供する変数を組み合わせることで、例えば：
- `${studio}/${actor}/${number}`：制作会社 → 俳優 → 番号の階層で組織化します
- `${year}/${month}/${title_safe}`：年 → 月 → タイトルの階層で組織化します

