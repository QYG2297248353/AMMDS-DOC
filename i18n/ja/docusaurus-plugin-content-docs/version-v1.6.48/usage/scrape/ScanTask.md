---
sidebar_position: 1
sidebar_label: "スキャンタスクの作成"
---

# スキャンタスクの作成

スキャンタスクはスクレイピングプロセスの最初のステップであり、スキャンルールに基づいてターゲットディレクトリ内のファイルをスキャンし、スキャン結果ファイルを生成します。スキャンタスクを使用することで、ファイルを選択的にスクレイピングすることができ、スクレイピングの効率を向上させると同時に、不要なファイルのスクレイピングを回避することができます。

<!-- truncate -->

## タスクリストへのアクセス

タスクリストページには、以下のパスからアクセスできます：

**タスク管理 >> タスク設定 >> タスクリスト**

タスクリストページで、**タスク作成** ボタンをクリックすると、スキャンタスクを作成することができます。

## マルチタスク管理

必要に応じて、複数の異なるスキャンタスクを設定することができます。各タスクは、異なるスキャンディレクトリと出力ディレクトリを持つことができます。

**マルチタスク管理の利点**：
- 動画ファイルの分類と管理に役立ちます
- 異なるタイプの動画ファイルに対して異なる処理ルールを設定することができます
- 全体的な処理効率を向上させます

**例**：
- 日本産の動画ファイルを専門的にスキャンし、指定されたディレクトリに出力するスキャンタスクを作成します
- 欧米の動画ファイルを専門的にスキャンし、別のディレクトリに出力する別のスキャンタスクを作成します

## スキャンタスクの作成

![スキャンタスクの作成](/img/usage/scrape/task-scan-01.png)

### タスク名

**機能説明**：スキャンタスクの名前を設定します。

**設定の推奨**：後の管理と識別が容易になるように、説明的な名前を使用してください。例："日本産動画スキャン"、"欧米動画スキャン"など。

### メディアタイプ

**機能説明**：スキャンタスクのメディアタイプを設定します。

**効果**：システムによる番号識別を支援し、番号識別率を向上させます。

**設定の推奨**：混合タイプの動画ファイルの場合は、「全部」を選択すれば大丈夫です。

### 整理モード

**機能説明**：ファイル整理の方法を設定します。

**利用可能なモード**：

#### 原地整理
- **機能**：整理時に親ディレクトリに対して何の操作も行わず、元のファイルが存在するディレクトリ内で直接整理します
- **適用シナリオ**：ファイルの位置を変更せず、ファイルの名前変更やメタデータ整理のみを行いたい場合

#### 移動モード
- **機能**：整理時にファイルをターゲットディレクトリに移動します
- **ターゲットディレクトリ**：スクレイピング設定で設定された形式
- **適用シナリオ**：ファイルを指定されたディレクトリに集中管理したい場合

#### コピーモード
- **機能**：整理時にファイルをターゲットディレクトリにコピーします
- **ターゲットディレクトリ**：スクレイピング設定で設定された形式
- **適用シナリオ**：元のファイルを保持しながら、指定されたディレクトリに整理後のコピーを作成したい場合

#### ソフトリンクモード
- **機能**：整理時にファイルのソフトリンクをターゲットディレクトリに作成します
- **ターゲットディレクトリ**：スクレイピング設定で設定された形式
- **特徴**：
  - 追加のディスク領域を占有しません
  - ソフトリンクファイルは元のファイルを指すポインタです
  - 元のファイルが削除または移動された場合、ソフトリンクファイルは無効になります
- **適用シナリオ**：追加のスペースを占有せずに、指定されたディレクトリにファイルへのアクセスエントリを作成したい場合

#### ハードリンクモード
- **機能**：整理時にファイルのハードリンクをターゲットディレクトリに作成します
- **ターゲットディレクトリ**：スクレイピング設定で設定された形式
- **特徴**：
  - 追加のディスク領域を占有します
  - ハードリンクファイルは元のファイルを指すポインタです
  - 元のファイルが削除または移動された場合でも、ハードリンクファイルは有効なままです
  - ハードリンクファイルは同じファイルシステム内でのみ作成できます
- **適用シナリオ**：同じファイルシステム内にファイルの複数の参照を作成し、ファイルの安全性を確保したい場合
- **注意**：条件が非常に厳しいため、一般的には推奨されません

:::info ヒント
原地整理モードを除く他の整理モードでは、ターゲットディレクトリを指定する必要があります。
:::

### スキャンディレクトリ

**機能説明**：スキャンタスクのターゲットディレクトリを設定します。

**効果**：システムはこのディレクトリ内のすべてのファイルを再帰的にスキャンします。

**設定の推奨**：処理が必要な動画ファイルを含むディレクトリを選択してください。

### 整理ディレクトリ

**機能説明**：ファイル整理のターゲットディレクトリを設定します。

**適用シナリオ**：原地整理モードを除く他の整理モードでは、このディレクトリを指定する必要があります。

**設定の推奨**：整理後のファイルを保存するために、十分なストレージ容量を持つディレクトリを選択してください。

### 名前変更ルール

**機能説明**：ファイル名を変更する方法を設定します。

**利用可能なルール**：

#### 元のファイル名
- **機能**：整理時に元のファイル名を変更しません
- **適用シナリオ**：ファイルの元の命名を保持したい場合

#### 標準化されたファイル名
- **機能**：整理時にスクレイピング設定で設定されたファイル名形式に基づいて、ファイル名を標準化します
- **命名の基準**：スクレイピング設定で設定されたファイル名形式に依存します
- **適用シナリオ**：ファイル命名形式を統一し、ファイル管理の標準化を向上させたい場合

### 重複ファイルの処理

**機能説明**：ターゲットファイルが既に存在する場合の処理方法を設定します。

**設定の推奨**：必要に応じて、スキップ、上書き、名前変更などの適切な処理方法を選択してください。

### ディレクトリモニタリング

**機能説明**：有効にすると、初回のスキャンタスクの初期化後、システムはこのディレクトリを監視し、新しいファイルが追加されたときに自動的にスキャンしてスキャン結果ファイルに追加します。

**適用シナリオ**：手動でスキャンをトリガーすることなく、システムに新しく追加されたファイルを自動的に処理させたい場合

### お気に入りに追加

**機能説明**：有効にすると、整理後にこの動画のメタデータが自動的にお気に入りに追加されます。

**適用シナリオ**：重要な動画リソースをすばやくマークしてアクセスしたい場合

### スケジュールタスク

**機能説明**：スキャンタスクの自動実行時間を設定します。

**注意**：この項目はディレクトリモニタリングと競合しますので、どちらか一方のみを選択してください。

**設定形式**：Spring スタイルの cron 式を使用します

**例**：スキャンタスクを毎時間実行するには、`0 0 * * * ?` と入力します

## スキャンタスクの実行

作成が完了したら、**即座にスキャン** ボタンをクリックすると、スキャンタスクを実行することができます。

![スキャンタスクの実行](/img/usage/scrape/task-scan-02.png)

### タスク管理操作

- **編集**：**編集** ボタンをクリックすると、スキャンタスクの設定を変更することができます
- **記録**：**記録** ボタンをクリックすると、スキャンタスクの実行履歴を表示することができます
- **削除**：**削除** ボタンをクリックすると、不要なスキャンタスクを削除することができます

### スキャン結果の確認

![スキャン結果の確認](/img/usage/scrape/task-scan-03.png)

スキャンが終了した後、新しいスクレイピング可能なファイルは **タスク管理 >> スクレイピング入庫** で確認・処理してください。

## スケジュールタスク

プロジェクトでは、スケジュールタスクの実行時間を指定するために、Spring スタイルの cron 式を使用しています。

### よく使用される式

| 式 | 説明 |
|--------|------|
| `0 0 * * * ?` | 毎時間実行 |
| `0 0 0 * * ?` | 毎日深夜に実行 |
| `0 0 0 * * 1` | 毎週月曜日の深夜に実行 |
| `0 0 0 1 * ?` | 毎月1日の深夜に実行 |

## 設定例

以下は、典型的なスキャンタスクの設定例です：

| 設定項目 | 設定値 |
|--------|--------|
| タスク名 | 日本産動画スキャン |
| メディアタイプ | 日本産 |
| 整理モード | 移動モード |
| スキャンディレクトリ | `D:\Downloads\NewMovies` |
| 整理ディレクトリ | `E:\Media\Movies\Japanese` |
| 名前変更ルール | 標準化されたファイル名 |
| 重複ファイルの処理 | スキップ |
| ディレクトリモニタリング | 有効 |
| お気に入りに追加 | 無効 |
| スケジュールタスク | - |

## よくある質問

### Q: スキャンタスクの実行に失敗した場合はどうすればよいですか？

**A**：考えられる原因は以下の通りです：
- スキャンディレクトリが存在しないか、アクセス権限がありません
- 整理ディレクトリが存在しないか、書き込み権限がありません
- 設定エラー
- システムリソース不足

**解決策**：
- ディレクトリパスと権限を確認してください
- 設定パラメータを確認してください
- システムに十分なリソースがあることを確認してください
- 実行記録を確認して具体的なエラー情報を了解してください

### Q: ディレクトリモニタリングとスケジュールタスクの違いは何ですか？

**A**：
- **ディレクトリモニタリング**：ディレクトリの変更をリアルタイムで監視し、新しいファイルが追加されたときに即座に処理します
- **スケジュールタスク**：事前に設定された時間間隔で定期的にスキャンを実行します

### Q: ソフトリンクとハードリンクの違いは何ですか？

**A**：
- **ソフトリンク**：Windowsのショートカットに相当し、追加のスペースを占有しませんが、元のファイルに依存します
- **ハードリンク**：ファイルの複数の参照に相当し、追加のスペースを占有しますが、元のファイルに依存しません（元のファイルが削除されても使用可能）

### Q: なぜスキャン結果に一部のファイルが表示されないのですか？

**A**：考えられる原因は以下の通りです：
- ファイル形式がスキャンルールの形式制限リストにない
- ファイルが存在するディレクトリが無視ディレクトリに追加されている
- ファイル名に無視される文字列が含まれている
- ファイルサイズが設定された最小動画サイズのしきい値より小さい

### Q: スキャン効率を向上させるにはどうすればよいですか？

**A**：以下の方法を試すことができます：
- 無視ディレクトリと無視ファイルを適切に設定する
- 異なるタイプのファイルに対して専門的なスキャンタスクを作成する
- ディレクトリモニタリング機能を使用して、繰り返しのスキャンを回避する
- システムリソースの割り当てを適切に調整する

## ベストプラクティス

- **タスクの分類**：動画のタイプに応じて異なるスキャンタスクを作成し、処理効率を向上させます
- **適切な命名**：後の管理が容易になるように、説明的なタスク名を使用します
- **定期的なメンテナンス**：不要なスキャンタスクを定期的に確認・整理します
- **設定のバックアップ**：重要な設定を変更する前に、現在の設定を記録しておき、問題が発生した場合に復元できるようにします
- **実行の監視**：スキャンタスクの実行記録を定期的に確認し、問題を早期に発見・解決します
