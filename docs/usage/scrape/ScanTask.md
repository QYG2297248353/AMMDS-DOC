---
sidebar_position: 1
sidebar_label: "创建扫描任务"
---

# 创建扫描任务

扫描任务是刮削流程的第一步，用于根据扫描规则对目标目录下的文件进行扫描，生成扫描结果文件。通过扫描任务，您可以选择性地对文件进行刮削，提高刮削效率，同时规避对垃圾文件的刮削。

<!-- truncate -->

## 访问任务列表

您可以通过以下路径访问任务列表页面：

**任务管理 >> 任务配置 >> 任务列表**

在任务列表页面，点击 **创建任务** 按钮，即可创建一个扫描任务。

## 多任务管理

您可以根据自己的需求，配置多个不同的扫描任务。每个任务可以有不同的扫描目录和输出目录。

**多任务管理的优势**：
- 有助于对影视文件进行分类和管理
- 可以针对不同类型的影视文件设置不同的处理规则
- 提高整体处理效率

**示例**：
- 创建一个扫描任务，专门扫描日产影视文件，并将其输出到指定目录
- 创建另一个扫描任务，专门扫描欧美影视文件，并将其输出到另一个目录

## 创建扫描任务

![创建扫描任务](/img/usage/scrape/task-scan-01.png)

### 任务名称

**功能说明**：设置扫描任务的名称。

**配置建议**：使用描述性的名称，便于后续管理和识别，例如："日产影视扫描"、"欧美影视扫描"等。

### 媒体类型

**功能说明**：设置扫描任务的媒体类型。

**作用**：辅助系统识别番号，提高番号识别率。

**配置建议**：如果是混合类型的影视文件，选择"全部"即可。

### 整理模式

**功能说明**：设置文件整理的方式。

**可选模式**：

#### 原地整理
- **功能**：整理时不对父目录进行任何操作，直接在原始文件所在目录进行整理
- **适用场景**：希望保持文件位置不变，仅对文件进行重命名或元数据整理

#### 移动模式
- **功能**：整理时将文件移动到目标目录
- **目标目录**：刮削配置中配置的格式
- **适用场景**：希望将文件集中管理到指定目录

#### 复制模式
- **功能**：整理时将文件复制到目标目录
- **目标目录**：刮削配置中配置的格式
- **适用场景**：希望保留原始文件，同时在指定目录创建整理后的副本

#### 软链接模式
- **功能**：整理时创建文件的软链接到目标目录
- **目标目录**：刮削配置中配置的格式
- **特点**：
  - 不占用额外的磁盘空间
  - 软链接文件是一个指向原始文件的指针
  - 如果原始文件被删除或移动，软链接文件将变得无效
- **适用场景**：希望在不占用额外空间的情况下，在指定目录创建文件的访问入口

#### 硬链接模式
- **功能**：整理时创建文件的硬链接到目标目录
- **目标目录**：刮削配置中配置的格式
- **特点**：
  - 会占用额外的磁盘空间
  - 硬链接文件是一个指向原始文件的指针
  - 如果原始文件被删除或移动，硬链接文件将保持有效
  - 硬链接文件只能在同一文件系统中创建
- **适用场景**：希望在同一文件系统中创建文件的多个引用，确保文件安全性
- **注意**：硬性条件很高，一般不建议使用

:::info 提示
除了原地整理模式，其他整理模式都需要指定目标目录。
:::

### 扫描目录

**功能说明**：设置扫描任务的目标目录。

**作用**：系统会递归扫描该目录下的所有文件。

**配置建议**：选择包含您需要处理的影视文件的目录。

### 整理目录

**功能说明**：设置文件整理的目标目录。

**适用场景**：除了原地整理模式，其他整理模式都需要指定此目录。

**配置建议**：选择一个有足够存储空间的目录，用于存放整理后的文件。

### 重命名规则

**功能说明**：设置文件重命名的方式。

**可选规则**：

#### 原文件名
- **功能**：整理时保持原始文件名不变
- **适用场景**：希望保留文件的原始命名

#### 标准化文件名
- **功能**：整理时根据刮削配置中配置的文件名格式，对文件名进行标准化
- **命名依据**：取决于刮削配置中配置的文件名格式
- **适用场景**：希望统一文件命名格式，提高文件管理的规范性

### 重复文件处理

**功能说明**：设置针对目标文件已存在的情况的处理方式。

**配置建议**：根据您的需求选择合适的处理方式，例如：跳过、覆盖、重命名等。

### 目录监控

**功能说明**：开启后，在首次初始化扫描任务后，系统会监控此目录，当出现新增文件时，会自动进行扫描并添加到扫描结果文件中。

**适用场景**：希望系统自动处理新添加的文件，无需手动触发扫描

### 加入收藏

**功能说明**：开启后，整理后会自动收藏此影视元数据。

**适用场景**：希望快速标记和访问重要的影视资源

### 计划任务

**功能说明**：设置扫描任务的自动执行时间。

**注意**：此项与目录监控冲突，只可选择其一。

**配置格式**：使用 Spring 风格的 cron 表达式

**示例**：每小时执行一次扫描任务，填写 `0 0 * * * ?`

## 执行扫描任务

创建完成后，点击 **立即扫描** 按钮，即可执行扫描任务。

![执行扫描任务](/img/usage/scrape/task-scan-02.png)

### 任务管理操作

- **编辑**：点击 **编辑** 按钮，即可修改扫描任务的配置
- **记录**：点击 **记录** 按钮，即可查看扫描任务的执行历史记录
- **删除**：点击 **删除** 按钮，即可删除不需要的扫描任务

### 扫描结果查看

![扫描结果查看](/img/usage/scrape/task-scan-03.png)

扫描结束后，新增的可刮削文件请前往 **任务管理 >> 刮削入库** 中进行查看和处理。

## 计划任务

项目使用 Spring 风格的 cron 表达式，用于指定计划任务的执行时间。

### 常用表达式

| 表达式 | 说明 |
|--------|------|
| `0 0 * * * ?` | 每小时执行一次 |
| `0 0 0 * * ?` | 每天凌晨执行一次 |
| `0 0 0 * * 1` | 每周一凌晨执行一次 |
| `0 0 0 1 * ?` | 每月1日凌晨执行一次 |

## 配置示例

以下是一个典型的扫描任务配置示例：

| 配置项 | 设置值 |
|--------|--------|
| 任务名称 | 日产影视扫描 |
| 媒体类型 | 日产 |
| 整理模式 | 移动模式 |
| 扫描目录 | `D:\Downloads\NewMovies` |
| 整理目录 | `E:\Media\Movies\Japanese` |
| 重命名规则 | 标准化文件名 |
| 重复文件处理 | 跳过 |
| 目录监控 | 开启 |
| 加入收藏 | 关闭 |
| 计划任务 | - |

## 常见问题

### Q: 扫描任务执行失败怎么办？

**A**：可能的原因包括：
- 扫描目录不存在或无权限访问
- 整理目录不存在或无权限写入
- 配置错误
- 系统资源不足

**解决方案**：
- 检查目录路径和权限
- 检查配置参数
- 确保系统有足够的资源
- 查看执行记录了解具体错误信息

### Q: 目录监控和计划任务有什么区别？

**A**：
- **目录监控**：实时监控目录变化，当有新文件添加时立即处理
- **计划任务**：按照预设的时间间隔定期执行扫描

### Q: 软链接和硬链接有什么区别？

**A**：
- **软链接**：相当于Windows的快捷方式，不占用额外空间，但依赖原始文件
- **硬链接**：相当于文件的多个引用，占用额外空间，但不依赖原始文件（原始文件删除后仍可使用）

### Q: 为什么扫描结果中没有显示某些文件？

**A**：可能的原因包括：
- 文件格式不在扫描规则的格式限制列表中
- 文件所在目录被添加到了忽略目录中
- 文件名包含被忽略的字符串
- 文件大小小于设置的最小视频大小阈值

### Q: 如何提高扫描效率？

**A**：可以尝试以下方法：
- 合理设置忽略目录和忽略文件
- 针对不同类型的文件创建专门的扫描任务
- 使用目录监控功能，避免重复扫描
- 适当调整系统资源分配

## 最佳实践

- **任务分类**：根据影视类型创建不同的扫描任务，提高处理效率
- **合理命名**：使用描述性的任务名称，便于后续管理
- **定期维护**：定期检查和清理不需要的扫描任务
- **备份配置**：在修改重要配置前，记录当前配置，以便在出现问题时恢复
- **监控执行**：定期查看扫描任务的执行记录，及时发现和解决问题
