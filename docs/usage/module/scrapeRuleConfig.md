---
sidebar_position: 2
sidebar_label: "刮削配置"
---

# 刮削配置

在任务执行前，对刮削规则进行配置。

<!-- truncate -->

通过 任务管理 >> 刮削规则配置 进入刮削规则配置页面。更新配置记得点击 保存 按钮。否则配置不会生效。

![刮削规则配置](/img/usage/module/scrape-config-01.png)

字符过滤:
    刮削时，对文件名进行过滤。提前过滤掉一些不需要的字符，提高番号的识别率。

允许图片下载失败:
    刮削时，允许图片下载失败。如果图片下载失败，不会影响刮削结果。

整理目录格式:
    刮削完成后，对目录进行整理。将刮削到的文件，按照一定的格式，创建目录。通过自定义组合格式，实现对目录的自定义整理。

整理文件名格式:
    刮削完成后，对文件名进行整理。将刮削到的文件，按照一定的格式，重命名视频文件。通过自定义组合格式，实现对文件名的自定义整理。

![刮削规则配置](/img/usage/module/scrape-config-02.png)

自动刮削:
    扫描任务完成后，自动触发刮削任务。默认情况下，用户需要手动选择扫描到的文件，执行刮削任务。
    如果开启自动刮削，会按照配置的规则，自动发现可刮削的影视文件。

自动刮削间隔:
    自动刮削任务的执行间隔。单位：分钟。开启自动刮削的情况下，每3分钟执行一次刮削任务。

高清封面下载:
    刮削时，下载影视的高清封面。如果开启，会在尝试获取 Fanza DMM 上的高清封面。
    如果 Fanza DMM 上没有高清封面，会尝试获取其他来源的高清封面。

外挂字幕搜索:
    刮削时，搜索并下载影视的外挂字幕，俗称软字幕。如果开启，会在尝试获取在线字幕文件。并下载至最终的刮削目录中。

番号混合:
    刮削后生成的 nfo 文件中，是否对 标题 等字段添加 番号前缀。

自动标签:
    刮削后生成的 nfo 文件中，在 tag 标签中添加额外信息。
    例如：添加 分辨率，番号，中字，破解 等标签。

自动分类标签:
    刮削后生成的 nfo 文件中，在 genre 标签中添加额外信息。
    例如：添加 分辨率，番号，中字，破解 等标签。

![刮削规则配置](/img/usage/module/scrape-config-03.png)

本地数据优先:
    刮削时，优先使用本地已有的数据。如果本地已有的数据符合刮削规则，会直接使用本地数据，而不会从网络上下载或更新数据。

刮削器:
    目前提供的刮削器有：
    - 本地 (用户手动创建的影视信息)
    - Metatube (插件)
    - ThePornDB (插件)
    - Stash (插件)
    - Fanza DMM (插件)

刮削剧照:
    刮削时，是否下载影视的剧照。如果开启，会在尝试获取在线剧照文件。并下载至最终的刮削目录中。

剧照目录:
    刮削时，下载的剧照文件，会被保存到指定的目录中。默认情况下，会保存到与视频文件相同的目录的 extrafanart 目录中。

多线程执行:
    刮削时，是否开启多线程执行。如果开启, 启动刮削任务时，会开启多个线程，并行执行刮削任务。
    开启多线程执行，会提高刮削效率，但也会增加系统资源的消耗。
    建议根据系统资源情况，合理配置多线程执行。
    例如：如果系统有 4 个 CPU 核心，建议设置为 4 个线程。

最大线程数:
    刮削时，最大线程数。默认值为 5 个线程。建议根据系统资源情况，合理配置最大线程数。

## 目录与文件名整理

在配置项中，有 整理目录格式 和 整理文件名格式 两个选项。在制定规则时，系统上默认带有一些变量，提供给用户使用。
通过组合这些变量，用户可以自定义目录和文件名的格式。

安全变量名：在变量名后添加 _safe 后缀，用于避免文件名中包含特殊字符导致的问题。

例如：${actor_safe} 如果 演员名称中出现特殊字符，会被替换为安全的字符。

像是影视标题中的特殊字符，会被替换为安全的字符。避免目录层级被特殊字符中断。

一个完整的视频文件，会被整理为：`${actor}/${number}/${title_safe}.${ext}`
示例：
- 演员名称："John Doe"
- 影片编号："ABC-123"
- 影片标题："Sample Title"
- 文件扩展名："mkv"

最终整理后的文件名：`John Doe/ABC-123/Sample Title.mkv`

### 整理目录变量

默认配置：`${actor}/${number}`

需要注意的是 `/` 会被识别为目录分隔符，可以创建不同的目录层级。

变量名	安全变量名	描述	示例
${actor}	${actor_safe}	演员名称	"John Smith"
${number}	${number_safe}	影片编号	"ABC-123"
${title}	${title_safe}	影片标题	"Sample Title"
${date}	${date_safe}	发行日期	"2024/01/01"
${year}	${year_safe}	发行年份	"2024"
${month}	${month_safe}	发行月份	"01"
${day}	${day_safe}	发行日期	"01"
${mosaic}	${mosaic_safe}	马赛克类型	"无码/有码"
${resolution}	${resolution_safe}	视频分辨率	"1080p"
${director}	${director_safe}	导演名称	"Director Name"
${studio}	${studio_safe}	制作商名称	"Studio Name"

默认值：所有变量均有默认值，若未指定，会使用默认值。

### 整理文件名变量

默认配置：`${number}`

变量名	安全变量名	描述	示例
${actor}	${actor_safe}	演员名称	"John Smith"
${number}	${number_safe}	影片编号	"ABC-123"
${title}	${title_safe}	影片标题	"Sample Title"
${date}	${date_safe}	发行日期	"2024/01/01"
${year}	${year_safe}	发行年份	"2024"
${month}	${month_safe}	发行月份	"01"
${day}	${day_safe}	发行日期	"01"
${mosaic}	${mosaic_safe}	马赛克类型	"无码/有码"
${resolution}	${resolution_safe}	视频分辨率	"1080p"
${director}	${director_safe}	导演名称	"Director Name"
${studio}	${studio_safe}	制作商名称	"Studio Name"

