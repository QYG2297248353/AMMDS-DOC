import{p as k,C as n,c as d,o as r,ad as o,G as e,j as i,a,w as E}from"./chunks/framework.DtW8lrcE.js";const F=JSON.parse('{"title":"Docker Compose","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"guide/deploy/install-docker-compose.md","filePath":"guide/deploy/install-docker-compose.md","lastUpdated":1750846713000}'),c={name:"guide/deploy/install-docker-compose.md"},u=Object.assign(c,{setup(g){const l=k([{label:"默认用户名",value:"ammds"},{label:"默认密码",value:"ammds"}]);return(y,s)=>{const p=n("a-image"),t=n("a-descriptions"),h=n("a-typography-text");return r(),d("div",null,[s[1]||(s[1]=o(`<h1 id="docker-compose" tabindex="-1">Docker Compose <a class="header-anchor" href="#docker-compose" aria-label="Permalink to &quot;Docker Compose&quot;">​</a></h1><p><strong>Docker Compose</strong> 是一个用于定义和运行多容器 Docker 应用程序的工具。通过一个 YAML 文件 (<code>docker-compose.yml</code>) 来配置应用程序的服务，然后只需一个命令即可启动所有服务。它非常适合开发、测试和登台环境中的快速部署和管理。</p><h2 id="创建服务" tabindex="-1">创建服务 <a class="header-anchor" href="#创建服务" aria-label="Permalink to &quot;创建服务&quot;">​</a></h2><h3 id="创建应用目录" tabindex="-1">创建应用目录 <a class="header-anchor" href="#创建应用目录" aria-label="Permalink to &quot;创建应用目录&quot;">​</a></h3><p>首先，创建一个名为 <code>ammds</code> 的目录用于存放相关文件：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ammds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ammds</span></span></code></pre></div><h3 id="创建配置文件" tabindex="-1">创建配置文件 <a class="header-anchor" href="#创建配置文件" aria-label="Permalink to &quot;创建配置文件&quot;">​</a></h3><p>在 <code>ammds</code> 目录下创建并编辑 <code>docker-compose.yml</code> 文件。将以下内容粘贴到文件中：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ammds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">qyg2297248353/ammds:latest</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 使用的镜像名称及版本标签</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">AMMDS</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 容器名称</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;8080:80&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 端口映射：主机端口8080映射到容器内的80端口</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./data:/ammds/data</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 将当前目录下的data文件夹挂载到容器内的/ammds/data路径</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./db:/ammds/db</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 将当前目录下的db文件夹挂载到容器内的/ammds/db路径</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./download:/ammds/download</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 将当前目录下的download文件夹挂载到容器内的/ammds/download路径</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./media:/media</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 将当前目录下的media文件夹挂载到容器内的/media路径</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">always</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 设置容器异常时总是自动重启</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">TZ=Asia/Shanghai</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 设置时区为亚洲/上海</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ammds-network</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 使用自定义网络</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ammds-network</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 自定义网络配置</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    driver</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">bridge</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 使用Docker默认的bridge网络驱动</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">提示</p><p>请自行挂载<code>本地媒体目录</code>到容器中，请勿使用前缀为 <code>/ammds</code> 作为媒体挂载目录使用。避免造成数据丢失。 假如宿主机目录为：<code>/mnt/movie</code> 推荐挂载格式：<code>- /mnt/movie:/mnt/movie</code></p></div><details class="details custom-block"><summary>云盘用户须知</summary><p>如果您使用 CloudDrive 等云盘挂载媒体目录的方式，请注意以下几点：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ammds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">qyg2297248353/ammds:latest</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">AMMDS</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;8080:80&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./data:/ammds/data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./db:/ammds/db</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./download:/ammds/download</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/media:/media:rw,rshared</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">always</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">TZ=Asia/Shanghai</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    cap_add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">SYS_ADMIN</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    devices</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/dev/fuse:/dev/fuse&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    security_opt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">apparmor:unconfined</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ammds-network</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">networks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ammds-network</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    driver</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">bridge</span></span></code></pre></div><p>特别注意：</p><ul><li><code>:rw,rshared</code> 除了基本的读写权限外，<code>rshared</code> 让容器之间保持共享传播。</li><li><code>SYS_ADMIN</code> 允许容器访问系统资源。</li><li><code>/dev/fuse:/dev/fuse</code> 允许容器访问 FUSE 设备。</li><li><code>apparmor:unconfined</code> 允许容器使用不受限制的 AppArmor 配置。</li></ul><p>该部署方案不适用于 <code>云盘挂载</code> + <code>目录监控</code> 的方案，请使用 <code>定时扫描</code> 代替 <code>目录监控</code>。</p></details><h2 id="启动服务" tabindex="-1">启动服务 <a class="header-anchor" href="#启动服务" aria-label="Permalink to &quot;启动服务&quot;">​</a></h2><p>使用以下命令来启动服务。这将在后台运行 AMMDS 容器，并应用 <code>docker-compose.yml</code> 中的所有配置：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span></code></pre></div><h2 id="停止服务" tabindex="-1">停止服务 <a class="header-anchor" href="#停止服务" aria-label="Permalink to &quot;停止服务&quot;">​</a></h2><p>如果需要停止并移除服务，可以使用以下命令：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> down</span></span></code></pre></div><h2 id="使用向导" tabindex="-1">使用向导 <a class="header-anchor" href="#使用向导" aria-label="Permalink to &quot;使用向导&quot;">​</a></h2><p>您可以通过浏览器打开：<a href="http://127.0.0.1:8080" target="_blank" rel="noreferrer">http://127.0.0.1:8080</a> 访问服务</p><p>访问由：<code>主机IP地址</code> + <code>服务端口</code> 构成</p>`,20)),e(p,{src:"/images/system/setup-finish-001.png"}),s[2]||(s[2]=i("h3",{id:"开始享受🥳",tabindex:"-1"},[a("开始享受🥳 "),i("a",{class:"header-anchor",href:"#开始享受🥳","aria-label":'Permalink to "开始享受🥳"'},"​")],-1)),e(t,{style:{"margin-top":"20px"},data:l.value,size:"medium",column:1},null,8,["data"]),e(h,{type:"secondary"},{default:E(()=>s[0]||(s[0]=[a(" 如果看不清，请改为亮色模式 ")])),_:1}),s[3]||(s[3]=i("br",null,null,-1)),s[4]||(s[4]=i("br",null,null,-1)),s[5]||(s[5]=i("footer",{style:{"font-size":"0.8em"}},[a(" 新疆萌森软件开发工作室提供技术支持 "),i("br"),a(" 版权所有 © 2023-2025 "),i("a",{href:"https://beian.miit.gov.cn",rel:"noreferrer",target:"_blank"},"新ICP备2023003452号-1")],-1))])}}});export{F as __pageData,u as default};
